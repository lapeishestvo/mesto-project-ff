(()=>{"use strict";var e="https://nomoreparties.co/v1/wff-cohort-16",t={authorization:"39abbecd-917f-4c6d-8dbf-06f37eb82d0b","Content-Type":"application/json"};function o(e,t,o,n,r,c,u,i,a){var l=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),p=u===i,s=o.some((function(e){return e._id===i}));return l.querySelector(".card__title").textContent=e,l.querySelector(".card__image").src=t,l.querySelector(".card__image").alt="Фотография с видами региона ".concat(e),l.querySelector(".card__image").addEventListener("click",c),l.querySelector(".card__like-button").addEventListener("click",(function(e){return r(a,e)})),l.querySelector(".card__likes_counter").textContent=o.length,p?l.querySelector(".card__delete-button").addEventListener("click",(function(e){return n(a,e)})):l.querySelector(".card__delete-button").classList.add("card__delete-button_hidden"),s?l.querySelector(".card__like-button").classList.add("card__like-button_is-active"):l.querySelector(".card__like-button").classList.remove("card__like-button_is-active"),l}function n(o,n){var r;console.log(n),n.target.closest(".places__item").remove(),console.log(n.target),r=o,fetch("".concat(e,"/cards/").concat(r),{method:"DELETE",headers:{authorization:t.authorization,"Content-Type":t["Content-Type"]}})}function r(o,n){var r,c=n.target,u=c.closest(".places__item").querySelector(".card__likes_counter"),i=c.classList.contains("card__like-button_is-active");(i?(r=o,fetch("".concat(e,"/cards/likes/").concat(r),{method:"DELETE",headers:{authorization:t.authorization,"Content-Type":t["Content-Type"]}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))):function(o){return fetch("".concat(e,"/cards/likes/").concat(o),{method:"PUT",headers:{authorization:t.authorization,"Content-Type":t["Content-Type"]}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(o)).then((function(e){i?c.classList.remove("card__like-button_is-active"):c.classList.add("card__like-button_is-active"),u.textContent=e.likes.length})).catch((function(e){console.error("Error updating likes:",e)}))}var c=function(e,t,o){var n=e.querySelector(".".concat(t.name,"-error"));t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""},u=function(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(o.inactiveButtonClass):t.classList.add(o.inactiveButtonClass)},i=function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector));o.forEach((function(o){c(e,o,t)}));var n=e.querySelector(t.submitButtonSelector);u(o,n,t)};function a(e){var t=e.querySelector(".popup__form");function o(e){e.target.classList.contains("popup")&&l(e.target)}function n(){l(e)}function r(t){"Escape"===t.key&&l(e)}Array.from(t.querySelectorAll(".popup__input")),t.querySelector(".popup__button"),e.classList.remove("popup_is-animated"),e.classList.add("popup_is-opened"),e.addEventListener("click",o),e.querySelector(".popup__close").addEventListener("click",n),document.addEventListener("keydown",r),i(t,{inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}),e._closePopupByOverlay=o,e._closePopupOnCloseButton=n,e._stopPropagation=function(e){e.stopPropagation()},e._closePopupOnEscape=r}function l(e){e.classList.remove("popup_is-opened"),e.classList.add("popup_is-animated"),e.removeEventListener("click",e._closePopupOnClick),e.querySelector(".popup__content").removeEventListener("click",e._stopPropagation),document.removeEventListener("keydown",e._closePopupOnEscape),delete e._closePopupOnClick,delete e._stopPropagation,delete e._closePopupOnEscape,delete e._closePopupByOverlay}function p(e,t){e.querySelector(".popup__button").textContent=t?"Сохранение...":"Сохранить"}var s,_=document.querySelector(".places__list"),d=document.querySelector(".popup_type_image"),f=document.querySelector(".profile__edit-button"),y=document.querySelector(".popup_type_edit"),m=y.querySelector(".popup__form"),v=document.querySelector(".popup__input_type_name"),h=document.querySelector(".popup__input_type_description"),S=document.querySelector(".profile__add-button"),q=document.querySelector(".popup_type_new-card"),C=q.querySelector(".popup__form"),b=document.querySelector(".popup__input_type_card-name"),g=document.querySelector(".popup__input_type_url"),k=(document.querySelector("#card-template").content,document.querySelector(".profile__image")),E=document.querySelector(".popup_type_avatar"),L=E.querySelector(".popup__form"),P=(document.querySelector(".popup__input_type_avatar"),"");function T(e){var t=e.target.closest(".places__item");a(d),document.querySelector(".popup__image").src=e.target.src,document.querySelector(".popup__image").alt=e.target.alt,document.querySelector(".popup__caption").textContent=t.querySelector(".card__title").textContent}function z(e){document.querySelector(".profile__title").textContent=e.name,document.querySelector(".profile__description").textContent=e.about,document.querySelector(".profile__image").style="background-image: url(".concat(e.avatar,")")}f.addEventListener("click",(function(){a(y),v.value=document.querySelector(".profile__title").textContent,h.value=document.querySelector(".profile__description").textContent})),m.addEventListener("submit",(function(o){var n,r,c=y.querySelector(".popup__form");o.preventDefault(),p(y,!0),(n=document.querySelector(".popup__input_type_name").value,r=document.querySelector(".popup__input_type_description").value,fetch("".concat(e,"/users/me "),{method:"PATCH",headers:{authorization:t.authorization,"Content-Type":t["Content-Type"]},body:JSON.stringify({name:n,about:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){e?z(e):console.log("Failed to load user info")})).then((function(){return l(y)})).finally((function(){return p(y,!1)})),i(c,{inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})})),S.addEventListener("click",(function(){a(q)})),C.addEventListener("submit",(function(c){var u,i;c.preventDefault(),p(q,!0),(u=b.value,i=g.value,fetch("".concat(e,"/cards"),{method:"POST",headers:{authorization:t.authorization,"Content-Type":t["Content-Type"]},body:JSON.stringify({name:u,link:i})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){e?(_.prepend(o(e.name,e.link,e.likes,n,r,T,e.owner._id,P,e._id)),C.reset(),l(q)):console.log("Failed to load user info")})).finally((function(){return p(q,!1)}))})),k.addEventListener("click",(function(){a(E)})),L.addEventListener("submit",(function(o){o.preventDefault(),p(y,!0),function(o){return fetch("".concat(e,"/users/me/avatar"),{method:"PATCH",headers:{authorization:t.authorization,"Content-Type":t["Content-Type"]},body:JSON.stringify({avatar:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(E.value).then((function(e){e?z(e):console.log("Failed to load user info")})).then((function(){return l(E)})).finally((function(){return p(E,!1)}))})),s={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(s.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);u(o,n,t),o.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,o){t.validity.patternMismatch?t.setCustomValidity("Поле может содержать только латинские и кириллические буквы, знаки дефиса и пробелы."):t.setCustomValidity(""),t.validity.valid?c(e,t,o):function(e,t,o,n){var r=e.querySelector(".".concat(t.name,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,t.validationMessage,o)}(e,r,t),u(o,n,t)}))}))}(e,s)})),fetch("".concat(e,"/users/me "),{headers:{authorization:t.authorization,"Content-Type":t["Content-Type"]}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).then((function(e){e?(z(e),P=e._id):console.log("Failed to load user info")})),fetch("".concat(e,"/cards"),{headers:{authorization:t.authorization,"Content-Type":t["Content-Type"]}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).then((function(e){e?e.forEach((function(e){_.append(o(e.name,e.link,e.likes,n,r,T,e.owner._id,P,e._id))})):console.log("Failed to load cards")}))})();